generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id               String            @id @default(auto()) @map("_id") @db.ObjectId
  email            String            @unique
  name             String
  password         Password?
  cpf              Int               @unique
  rg               Int               @unique
  phoneNumber      String
  dateOfBirth      String
  country          String
  role             Role              @default(DELEGADO)
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  delegation       Delegation?       @relation(fields: [delegationId], references: [id])
  delegationId     String?           @db.ObjectId
  userPreferences  UserPreferences?
  userPersonalInfo UserPersonalInfo?
}

model Delegation {
  id    String  @id @default(auto()) @map("_id") @db.ObjectId
  name  String  @unique
  code  String? @unique
  users User[]
}

model UserPersonalInfo {
  id                  String              @id @default(auto()) @map("_id") @db.ObjectId
  user                User?               @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  userId              String              @unique @db.ObjectId
  languagesSimulates  Language[]
  currentCourse       String
  schoolarYear        Int
  councilPreference   Council
  participationMethod ParticipationMethod
}

model UserPreferences {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  user         User?    @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  userId       String   @unique @db.ObjectId
  emailUpdates Boolean
  language     Language @default(Portuguese)
}

model Password {
  id     String @id @default(auto()) @map("_id") @db.ObjectId
  hash   String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  userId String @unique
}

enum Role {
  DELEGADO
  DELEGADO_CHEFE
  PROFESSOR
  ADMIN
}

enum Council {
  ConselhoJuventudeOnu
  AssembleiaGeralOnu
  ConselhoSegurancaOnu
}

enum ParticipationMethod {
  Online
  Presential
}

enum Language {
  Portuguese
  English
  Spanish
}
